<!DOCTYPE html>
<html lang="en">
<head>
  <title>Starducks — Public Chat</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="assets/favicon.svg" type="image/svg+xml">
  <style>
    @font-face{ font-family:"HeadingCustom"; src:url("./assets/fonts/Foglihten.ttf") format("truetype"); font-display:swap; }
    @font-face{ font-family:"Alagard"; src:url("./assets/fonts/Alagard.ttf") format("truetype"); font-display:swap; }
    :root{ --bg:#000; --ink:#f2f2f2; --muted:#9aa1a6; --accent:#ff2b4d; --card:rgba(255,255,255,.08); --border:rgba(255,255,255,.15); }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0; color:var(--ink); background:#000; font-family:Alagard, ui-serif, Georgia, serif; letter-spacing:.2px; overflow-x:hidden}
    #stars{position:fixed; inset:0; z-index:-1; background:#000}
    header{ position:sticky; top:0; backdrop-filter:blur(8px); background:linear-gradient(0deg, transparent, rgba(0,0,0,.65)); border-bottom:1px solid var(--border); z-index:50; }
    .row{max-width:1200px; margin:0 auto; padding:14px 18px; display:flex; align-items:center; gap:14px}
    .brand img{height:40px; display:block}
    .spacer{flex:1}
    .btn{cursor:pointer; border:1px solid var(--border); background:var(--card); color:var(--ink); padding:10px 14px; border-radius:12px; font-size:14px; transition:.2s; text-decoration:none; display:inline-flex; align-items:center; gap:10px}
    .btn:hover{transform:translateY(-1px); background:rgba(255,255,255,.12)}
    .btn.primary{background:var(--accent); border-color:transparent; color:#fff}
    footer{max-width:1200px; margin:100px auto 30px; padding:0 18px; text-align:center; color:#b5b5b5; font-size:12px; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial; }
    .glass{background:var(--card); border:1px solid var(--border); border-radius:18px; padding:18px; box-shadow:0 6px 24px rgba(0,0,0,.35)}
  </style>

  <style>
    .wrap{max-width:900px; margin:24px auto; padding:0 18px}
    .chat{min-height:360px; max-height:520px; overflow:auto; background:rgba(255,255,255,.04); border:1px solid var(--border); border-radius:14px; padding:10px}
    .chat p{margin:6px 0}
    .meta{font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; color:#bfc6cc; font-size:13px}
    .bar{display:flex; gap:10px; margin-top:10px}
    .bar input{flex:1; background:transparent; border:1px solid var(--border); color:var(--ink); padding:10px 12px; border-radius:12px}
  </style>
</head>
<body>
  <canvas id="stars"></canvas>
  <header>
    <div class="row">
      <a class="brand" href="index.html"><img src="assets/logo.svg" alt="Starducks"></a>
      <div class="spacer"></div>
      <a class="btn" href="index.html">Home</a>
      <a class="btn" href="login.html">Join</a>
    </div>
  </header>

  <div class="wrap glass">
    <h2 style="font-family:HeadingCustom,Impact;margin:0 0 10px">Public Chat</h2>
    <div id="warn" class="meta" style="margin-bottom:8px"></div>
    <div class="chat" id="chatBox"></div>
    <div class="bar">
      <input id="chatMsg" type="text" placeholder="Sign in to chat…" disabled/>
      <button class="btn" id="send" disabled>Send</button>
    </div>
  </div>

  <footer>Design by Uefa Chankarn</footer>

  <script>

  const starCanvas = document.getElementById('stars');
  if(starCanvas){
    const ctx = starCanvas.getContext('2d'); let W,H,stars=[];
    function resize(){W=starCanvas.width=innerWidth; H=starCanvas.height=innerHeight} addEventListener('resize', resize); resize();
    function makeStars(n=1600){ stars=[...Array(n)].map(()=>({x:Math.random()*W,y:Math.random()*H,z:Math.random()*1.6+.2,r:Math.random()*1.3+.2,v:Math.random()*0.28+.05})) } makeStars();
    (function loop(){ ctx.fillStyle='#000'; ctx.fillRect(0,0,W,H); for(const s of stars){ s.y+=s.v*s.z; if(s.y>H) s.y=0, s.x=Math.random()*W; ctx.beginPath(); ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fillStyle='rgba(255,255,255,'+(0.55+Math.random()*0.45)+')'; ctx.fill(); } requestAnimationFrame(loop) })();
  }

  const store={get(k,d){try{return JSON.parse(localStorage.getItem(k))??d}catch{return d}}, set(k,v){localStorage.setItem(k,JSON.stringify(v))}};
  const state = { user: store.get('user', null), creators: store.get('creators', {}), posts: store.get('posts', []), chat: store.get('chat', []), songURL: store.get('songURL', '') };
  function save(){ store.set('user',state.user); store.set('creators',state.creators); store.set('posts',state.posts); store.set('chat',state.chat); store.set('songURL',state.songURL); }
  const CODE_CREATOR = atob("MTIwNw==");  // hidden
  const CODE_SONG = atob("MjYyNg==");     // hidden
  function notifyEmail(msg){ console.log('Notify → uefa.sorawit.chankarn@gmail.com :', msg); }

    function renderChat(){ const box=document.getElementById('chatBox'); box.innerHTML=state.chat.map(m=>`<p><b>${m.by}</b> <span class="meta">${new Date(m.ts).toLocaleTimeString()}</span><br>${m.text}</p>`).join(''); box.scrollTop=box.scrollHeight; }
    function gate(){
      const signed=!!state.user;
      document.getElementById('warn').textContent = signed ? '' : 'Please sign in on the Join page to participate.';
      document.getElementById('chatMsg').disabled = !signed;
      document.getElementById('send').disabled = !signed;
    }
    document.getElementById('send').onclick = ()=>{ const t=document.getElementById('chatMsg').value.trim(); if(!t) return; state.chat.push({by: state.user?.name||'Guest', text:t, ts:Date.now()}); save(); document.getElementById('chatMsg').value=''; renderChat(); };
    gate(); renderChat();
  </script>
</body>
</html>
